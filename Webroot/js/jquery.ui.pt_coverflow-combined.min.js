/*
 * Copyright (c) 2012 Planet Telex Inc. all rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
typeof jQuery!="undefined"&&typeof jQuery.ui!="undefined"&&(function(b){Math.degreesToRadians=function(d){return d*(Math.PI/180)
};
b.widget("pt.cover",{widgetEventPrefix:"pt.cover",options:{id:(new Date()).getTime()*Math.random(),width:300,height:300,patchSize:70,perspective:{angle:0,enabled:true,position:"center"},subdivisionLimit:3,animation:{slide:{duration:900,easing:"easeOutCirc"},perspective:{duration:120,easing:"jswing"}},canvas:{background:"white",left:0,top:0,zIndex:0,opacity:1},reflection:{enabled:true,initialOpacity:50,length:80},title:{enabled:true}},_create:function(){this.options.refreshState=this._refreshState;
if(this.element[0].nodeType===1&&this.element[0].tagName.toLowerCase()==="img"&&this.element[0].src!==""){if(this.element[0].complete||this.element[0].readyState===4){this._load()
}else{if(this.readyState==="uninitialized"&&this.src.indexOf("data:")===0){this.element.trigger("error")
}else{this.element.load(this._load.bind(this))
}}}},_setOption:function(d,e){b.Widget.prototype._setOption.apply(this,arguments)
},destroy:function(){if(this.supportsCanvas&&this._$cover){this._$cover.remove()
}else{this.element.unbind().css({visibility:this._previousVisibility,opacity:"",background:"",top:"",left:"",zIndex:"",textIndent:"",position:"",cursor:""})
}if(this._hasTitle()){this._$titleContainer.remove()
}b.Widget.prototype.destroy.call(this)
},_$cover:null,_drawing:null,_previousOptions:null,_previousVisibility:null,_cachedCanvas:null,_refreshState:1,_$titleContainer:null,supportsCanvas:(function(){var d=document.createElement("canvas");
return !!(d.getContext&&d.getContext("2d"))
})(),left:function(){var d=this._height();
var e=[[0,0],[this.options.width,this._skewLength()],[0,d],[this.options.width,d-this._skewLength()]];
this._draw(e)
},center:function(){var d=this._height();
var e=[[0,0],[this.options.width,0],[0,d],[this.options.width,d]];
this._draw(e)
},right:function(){var d=this._height();
var e=[[0,this._skewLength()],[this.options.width,0],[0,d-this._skewLength()],[this.options.width,d]];
this._draw(e)
},refresh:function(d){d=d||false;
++this.options.refreshState;
if(this._hasTitle()){switch(this.options.perspective.position){case"center":this._$titleContainer.show();
break;
default:this._$titleContainer.hide()
}}if(!d){this._$cover.css({zIndex:this.options.canvas.zIndex,top:this.options.canvas.top,left:this.options.canvas.left,opacity:this.options.canvas.opacity});
this._perspective();
this._syncRefreshState();
this._triggerRefreshed()
}else{this._$cover.css({zIndex:this.options.canvas.zIndex,top:this.options.canvas.top}).animate({left:this.options.canvas.left,opacity:this.options.canvas.opacity},{queue:false,duration:this.options.animation.slide.duration,easing:this.options.animation.slide.easing,complete:this._animateLeftComplete.bind(this)}).animate({textIndent:this.options.perspective.position=="center"?0:this.options.perspective.angle},{queue:false,duration:this.options.animation.perspective.duration,easing:this.options.animation.perspective.easing,step:this._animateAngleStep.bind(this),complete:this._animateAngleComplete.bind(this)})
}},raiseZ:function(){++this.options.canvas.zIndex;
this._$cover.css({zIndex:this.options.canvas.zIndex})
},lowerZ:function(){--this.options.canvas.zIndex;
this._$cover.css({zIndex:this.options.canvas.zIndex})
},_animateAngleStep:function(e,f){if(f.prop=="textIndent"){var d=this._previousOptions.perspective.position;
if(d=="center"){d=this.options.perspective.position
}this.options.perspective.angle=e;
this._perspective(d)
}},_animateAngleComplete:function(){this._perspective();
this._syncRefreshState()
},_animateLeftComplete:function(){this._triggerRefreshed()
},_height:function(){var d=this.options.height;
if(this.options.reflection.enabled){d*=2
}return d
},_skewLength:function(){return Math.tan(Math.degreesToRadians(this.options.perspective.angle))*this.options.width
},_load:function(){this._$cover=this.element;
if(this.supportsCanvas){this._$cover=b("<canvas/>")
}this._$cover.attr({width:this.options.width,height:this.options.height}).css({opacity:this.options.canvas.opacity,background:this.options.canvas.background,top:this.options.canvas.top,left:this.options.canvas.left,zIndex:this.options.canvas.zIndex,textIndent:this.options.perspective.angle,position:"absolute",cursor:"pointer"}).click(this._click.bind(this)).mouseenter(this._mouseenter.bind(this)).mouseleave(this._mouseleave.bind(this));
if(this.supportsCanvas){this.element.css({top:-1000,left:-1000,position:"absolute"}).after(this._$cover);
this._drawing=new c.Drawing(this._$cover[0],this.options);
this._drawing.importImage(this.element[0]);
if(this.options.reflection.enabled){this._drawing.addMirror()
}this._cachedCanvas=this._drawing.cloneCanvas()
}else{this._previousVisibility=this.element.css("visibility");
this.element.css({visibility:"visible"})
}if(this.options.title.enabled){this._$titleContainer=b("<div/>").addClass("cover-title").append(b("<h1/>").text(this.element.data("title"))).append(b("<h2/>").text(this.element.data("subtitle"))).hide();
this.element.after(this._$titleContainer)
}this.refresh()
},_click:function(d){this._trigger("click",d,{image:this.element})
},_mouseenter:function(d){this._trigger("mouseenter",d,{image:this.element})
},_mouseleave:function(d){this._trigger("mouseleave",d,{image:this.element})
},_draw:function(d){if(this.supportsCanvas){this._drawing.perspective(d,this._cachedCanvas,!this.options.reflection.enabled);
if(this.options.reflection.enabled){this._drawing.addMirrorReflection()
}}else{this._$cover.attr({width:this.options.width,height:this.options.height})
}},_hasTitle:function(){return this.options.title.enabled&&this._$titleContainer
},_perspective:function(d){d=d||this.options.perspective.position;
if(!this._previousOptions||this._previousOptions.perspective.position!=this.options.perspective.position){if(this.options.perspective.enabled){this[d]()
}else{this.center()
}}},_syncRefreshState:function(){if(this.options.refreshState-this._refreshState<=1){this._previousOptions=b.extend(true,{},this.options)
}++this._refreshState
},_triggerRefreshed:function(){this._trigger("refreshed-"+this.options.id,null,{image:this.element})
}});
var c=c||{};
c.Drawing=function(e,d){this.canvas=e;
this.ctx=this.canvas.getContext("2d");
this.options=b.extend({subdivisionLimit:3,patchSize:70,reflection:{initialOpacity:50,length:80}},d);
this.transform=null;
this.iw=0;
this.ih=0
};
c.Drawing.prototype.cloneCanvas=function(){var f=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);
var d=document.createElement("canvas");
d.width=this.canvas.width;
d.height=this.canvas.height;
var e=d.getContext("2d");
e.putImageData(f,0,0);
return d
};
c.Drawing.prototype.importImage=function(d){this.ctx.drawImage(d,0,0,this.canvas.width,this.canvas.height)
};
c.Drawing.prototype.perspective=function(n,m,p){this.image=m||this.cloneCanvas();
var k=Infinity,f=-Infinity,h=Infinity,e=-Infinity;
b.each(n,function(){k=Math.min(k,Math.floor(this[0]));
f=Math.max(f,Math.ceil(this[0]));
h=Math.min(h,Math.floor(this[1]));
e=Math.max(e,Math.ceil(this[1]))
});
var g=f-k;
var o=e-h;
this.canvas.width=g;
this.canvas.height=o;
this.iw=this.image.width;
this.ih=this.image.height;
this.ctx.translate(-k,-h);
this.ctx.clearRect(k,h,g,o);
this.transform=a.getProjectiveTransform(n);
var j=this.transform.transformProjectiveVector([0,0,1]);
var d=this.transform.transformProjectiveVector([1,0,1]);
var l=this.transform.transformProjectiveVector([0,1,1]);
var i=this.transform.transformProjectiveVector([1,1,1]);
if(p){this.ctx.beginPath();
this.ctx.moveTo(j[0],j[1]);
this.ctx.lineTo(d[0],d[1]);
this.ctx.lineTo(i[0],i[1]);
this.ctx.lineTo(l[0],l[1]);
this.ctx.closePath();
this.ctx.clip()
}this.divide(0,0,1,1,j,d,l,i,this.options.subdivisionLimit)
};
c.Drawing.prototype.addMirror=function(){var d=this.cloneCanvas();
this.canvas.height*=2;
this.ctx.drawImage(d,0,0);
this.ctx.save();
this.ctx.translate(0,this.canvas.height);
this.ctx.scale(1,-1);
this.ctx.drawImage(d,0,0);
this.ctx.restore()
};
c.Drawing.prototype.addMirrorReflection=function(){var d=Math.floor(this.canvas.height/2);
var e=this.options.reflection.initialOpacity/100;
var f=this.options.reflection.length/100;
this.ctx.save();
this.ctx.globalCompositeOperation="destination-out";
var g=this.ctx.createLinearGradient(0,d,0,this.canvas.height);
g.addColorStop(0,"rgba(255, 255, 255, "+(1-e)+")");
g.addColorStop(f,"rgba(255, 255, 255, 1.0)");
g.addColorStop(1,"rgba(255, 255, 255, 1.0)");
this.ctx.fillStyle=g;
this.ctx.rect(0,d,this.canvas.width,d);
this.ctx.fill();
this.ctx.restore()
};
c.Drawing.prototype.divide=function(n,P,l,O,N,M,L,J,q){if(q){var E=[M[0]+L[0]-2*N[0],M[1]+L[1]-2*N[1]];
var C=[M[0]+L[0]-2*J[0],M[1]+L[1]-2*J[1]];
var B=[E[0]+C[0],E[1]+C[1]];
var x=Math.abs((B[0]*B[0]+B[1]*B[1])/(E[0]*C[0]+E[1]*C[1]));
E=[M[0]-N[0]+J[0]-L[0],M[1]-N[1]+J[1]-L[1]];
C=[L[0]-N[0]+J[0]-M[0],L[1]-N[1]+J[1]-M[1]];
var u=Math.abs(E[0]*C[1]-E[1]*C[0]);
if((n==0&&l==1)||((0.25+x*5)*u>(this.options.patchSize*this.options.patchSize))){var f=(n+l)/2;
var s=(P+O)/2;
var d=this.transform.transformProjectiveVector([f,s,1]);
var v=this.transform.transformProjectiveVector([f,P,1]);
var p=this.transform.transformProjectiveVector([f,O,1]);
var o=this.transform.transformProjectiveVector([n,s,1]);
var j=this.transform.transformProjectiveVector([l,s,1]);
q--;
this.divide(n,P,f,s,N,v,o,d,q);
this.divide(f,P,l,s,v,M,d,j,q);
this.divide(n,s,f,O,o,d,L,p,q);
this.divide(f,s,l,O,d,j,p,J,q);
return
}}this.ctx.save();
this.ctx.beginPath();
this.ctx.moveTo(N[0],N[1]);
this.ctx.lineTo(M[0],M[1]);
this.ctx.lineTo(J[0],J[1]);
this.ctx.lineTo(L[0],L[1]);
this.ctx.closePath();
var I=[M[0]-N[0],M[1]-N[1]];
var t=[J[0]-M[0],J[1]-M[1]];
var K=[L[0]-J[0],L[1]-J[1]];
var k=[N[0]-L[0],N[1]-L[1]];
var A=Math.abs(I[0]*k[1]-I[1]*k[0]);
var z=Math.abs(t[0]*I[1]-t[1]*I[0]);
var w=Math.abs(K[0]*t[1]-K[1]*t[0]);
var y=Math.abs(k[0]*K[1]-k[1]*K[0]);
var m=Math.max(Math.max(A,z),Math.max(y,w));
var g=0,e=0,F=0,D=0;
switch(m){case A:this.ctx.transform(I[0],I[1],-k[0],-k[1],N[0],N[1]);
if(l!=1){F=1.05/Math.sqrt(I[0]*I[0]+I[1]*I[1])
}if(O!=1){D=1.05/Math.sqrt(k[0]*k[0]+k[1]*k[1])
}break;
case z:this.ctx.transform(I[0],I[1],t[0],t[1],M[0],M[1]);
if(l!=1){F=1.05/Math.sqrt(I[0]*I[0]+I[1]*I[1])
}if(O!=1){D=1.05/Math.sqrt(t[0]*t[0]+t[1]*t[1])
}g=-1;
break;
case w:this.ctx.transform(-K[0],-K[1],t[0],t[1],J[0],J[1]);
if(l!=1){F=1.05/Math.sqrt(K[0]*K[0]+K[1]*K[1])
}if(O!=1){D=1.05/Math.sqrt(t[0]*t[0]+t[1]*t[1])
}g=-1;
e=-1;
break;
case y:this.ctx.transform(-K[0],-K[1],-k[0],-k[1],L[0],L[1]);
if(l!=1){F=1.05/Math.sqrt(K[0]*K[0]+K[1]*K[1])
}if(O!=1){D=1.05/Math.sqrt(k[0]*k[0]+k[1]*k[1])
}e=-1;
break
}var i=(l-n);
var h=(O-P);
var H=F*i;
var G=D*h;
this.ctx.drawImage(this.image,n*this.iw,P*this.ih,Math.min(l-n+H,1)*this.iw,Math.min(O-P+G,1)*this.ih,g,e,1+F,1+D);
this.ctx.restore()
};
var a=function(d){this.w=!d[0]?0:d[0].length;
this.h=d.length;
this.values=d
};
a.getProjectiveTransform=function(e){var f=new a([[1,1,1,0,0,0,-e[3][0],-e[3][0],-e[3][0]],[0,1,1,0,0,0,0,-e[2][0],-e[2][0]],[1,0,1,0,0,0,-e[1][0],0,-e[1][0]],[0,0,1,0,0,0,0,0,-e[0][0]],[0,0,0,-1,-1,-1,e[3][1],e[3][1],e[3][1]],[0,0,0,0,-1,-1,0,e[2][1],e[2][1]],[0,0,0,-1,0,-1,e[1][1],0,e[1][1]],[0,0,0,0,0,-1,0,0,e[0][1]]]);
var g=f.rowEchelon().values;
var d=new a([[-g[0][8],-g[1][8],-g[2][8]],[-g[3][8],-g[4][8],-g[5][8]],[-g[6][8],-g[7][8],1]]);
return d
};
a.cloneValues=function(d){var f=[];
for(var e=0;
e<d.length;
++e){f[e]=[].concat(d[e])
}return f
};
a.prototype.transformProjectiveVector=function(e){var f=[];
var h;
for(h=0;
h<this.h;
++h){f[h]=0;
for(var d=0;
d<this.w;
++d){f[h]+=this.values[h][d]*e[d]
}}var g=1/(f[f.length-1]);
for(h=0;
h<this.h;
++h){f[h]*=g
}return f
};
a.prototype.rowEchelon=function(){if(this.w<=this.h){throw"Matrix rowEchelon size mismatch"
}var k=a.cloneValues(this.values);
for(var d=0;
d<this.h;
++d){var i=k[d][d];
while(i==0){for(var j=d+1;
j<this.h;
++j){if(k[j][d]!=0){var l=k[j];
k[j]=k[d];
k[d]=l;
break
}}if(j==this.h){return new a(k)
}else{i=k[d][d]
}}var e=1/i;
var h;
for(h=d;
h<this.w;
++h){k[d][h]*=e
}for(var g=0;
g<this.h;
++g){if(g==d){continue
}var f=k[g][d];
k[g][d]=0;
for(h=d+1;
h<this.w;
++h){k[g][h]-=f*k[d][h]
}}}return new a(k)
};
if(!Function.prototype.bind){Function.prototype.bind=function(d){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")
}var h=Array.prototype.slice.call(arguments,1),g=this,e=function(){},f=function(){return g.apply(this instanceof e?this:d||window,h.concat(Array.prototype.slice.call(arguments)))
};
e.prototype=this.prototype;
f.prototype=new e();
return f
}
}})(jQuery);
typeof jQuery!="undefined"&&typeof jQuery.ui!="undefined"&&(function(b){var a={left:1,center:2,right:3};
b.widget("pt.coverflow",{widgetEventPrefix:"pt.coverflow",options:{width:null,height:null,selectedIndex:0,autoplay:{enabled:false,interval:3,pauseOnMouseenter:true,playsPerCategory:3},categories:{enabled:false,defaultCategory:"Unknown",selectedCategory:null,renderTitles:true,rememberLastCover:true,delAnimationCount:4,addAnimationRadius:4},cover:{height:300,width:300,animation:{perspective:{duration:80,inner:120},radius:20},background:{style:null,size:90,overlap:{inner:20,outer:80}},perspective:{angle:12,enabled:true},reflection:{enabled:true,initialOpacity:30,length:80},title:{enabled:true}},images:[],slider:{enabled:true,width:80}},_create:function(){this._categories=[];
this._categoryData={};
this.options.width=this.options.width||this.element.width();
this.options.height=this.options.height||this.element.height();
if(!b().slider){this.options.slider=false
}this._currentIndex=this.options.selectedIndex;
if(this.options.images.length>0){var c,e,d;
for(c in this.options.images){e=this.options.images[c];
d="";
if(e.title){d=e.title
}if(e.subtitle){if(d!=""){d+=", "
}d+=e.subtitle
}this.element.append(b("<img/>").attr({src:e.src,alt:d}).data({title:e.title,subtitle:e.subtitle,category:e.category}))
}}this.element.css({position:"relative",overflow:"hidden"});
this._$images=this.element.find("img");
this._loadImages();
this._loadSlider();
if(this.options.categories.enabled){this._setCurrentCategory(this.options.categories.selectedCategory);
this._loadCategoryTitles()
}if(this.options.autoplay.enabled){this._play()
}},_setOption:function(c,d){switch(c){case"selectedIndex":this._gotoCover(d);
break;
case"categories":if(d.selectedCategory!=this.options.categories.selectedCategory){this._gotoCategory(d.selectedCategory)
}break;
case"autoplay":if(d.enabled){this._play()
}else{this._pause()
}break
}b.Widget.prototype._setOption.apply(this,arguments)
},destroy:function(){this._pause();
this._$images.each(function(d,c){b(c).cover("destroy")
});
if(this._$categories){this._$categories.remove()
}if(this._$slider){this._$slider.slider("destroy").remove()
}this.element.unbind().css({position:"",overflow:""});
b.Widget.prototype.destroy.call(this)
},_$activeImages:[],_categories:[],_$categories:null,_$images:[],_categoryData:{},_isPauseManual:false,_$slider:null,_$sliderHandleHelper:null,_currentIndex:0,_currentCategoryIndex:0,_playIntervalId:null,_playCountInCategory:0,addImage:function(d,c){c=typeof c=="undefined"?true:c;
this._addImage(d,false,c);
this._trigger("imageAdded",null,{selectedIndex:this._currentIndex})
},_addImage:function(d,f,c){f=f||false;
if(!d.data("cover")){this._$activeImages.each(function(h,g){b(g).cover("raiseZ")
});
d.remove();
this.element.append(d);
var e=this._loadImage(d[0]);
if(f||(!this.options.categories.enabled||this._getCurrentCategory()==e)){this._$activeImages.push(d[0]);
this._createCover(this._imagesCount()-1,d[0],a.right);
this._updateCover(c,true,this._currentIndex,this._imagesCount()-1,d[0],a.center);
this._syncSlider()
}}},removeImage:function(c){c=typeof c=="undefined"?true:c;
if(this._imagesCount()>1){this._removeImage(false,c);
this._trigger("imageRemoved",null,{selectedIndex:this._currentIndex})
}},_removeImage:function(g,d){var e=0,f=this._$activeImages.splice(e,1);
this.element.one("pt.coverrefreshed-"+b(f).data("coverflow").id,function(i,h){b(h.image).cover("destroy")
});
this._updateCover(d,true,this._currentIndex,e,f,a.left);
this._$activeImages.each(function(i,h){b(h).cover("lowerZ");
b(h).data("coverflow").index=i
});
var c;
if(e==this._currentIndex){c=this._currentIndex
}else{c=this._currentIndex-1
}if(!g){this._gotoCover(c,true)
}else{this._currentIndex=c
}this._syncSlider();
return f
},isPlaying:function(){return(this._playIntervalId!=null)
},play:function(){this._isPauseManual=false;
var c=b.extend(true,{},this.options.autoplay);
c.enabled=true;
this._setOption("autoplay",c);
this._trigger("play",null,{selectedIndex:this._currentIndex})
},_play:function(){if(!this.isPlaying()){this._playIntervalId=setInterval(this._playNext.bind(this),this.options.autoplay.interval*1000)
}},_playNext:function(){if(this.options.categories.enabled){if(this._playCountInCategory>this._imagesCount()||this._playCountInCategory>=this.options.autoplay.playsPerCategory-1){this.nextCategory();
this._playCountInCategory=0;
return
}else{++this._playCountInCategory
}}this._nextCover()
},pause:function(){this._isPauseManual=true;
this._pause();
this._trigger("pause",null,{selectedIndex:this._currentIndex})
},_pause:function(){if(this.isPlaying()){clearInterval(this._playIntervalId);
this._playIntervalId=null
}},togglePlay:function(){if(this.isPlaying()){this._isPauseManual=true;
this._pause()
}else{this._isPauseManual=false;
var c=b.extend(true,{},this.options.autoplay);
c.enabled=true;
this._setOption("autoplay",c)
}this._trigger("togglePlay",null,{selectedIndex:this._currentIndex})
},_setCurrentCategory:function(d){if(d){for(var c=0;
c<this._categories.length;
c++){if(this._categories[c]==d){this._currentCategoryIndex=c;
break
}}}},_getCurrentCategory:function(){return this._categories[this._currentCategoryIndex]
},nextCategory:function(){if(this.options.categories.enabled){this._nextCategory();
this._trigger("nextCategory",null,{selectedCategory:this._getCurrentCategory()})
}},_nextCategory:function(){var c;
if(this._currentCategoryIndex==this._categories.length-1){c=0
}else{c=this._currentCategoryIndex+1
}if(c!=this._currentCategoryIndex){this._gotoCategory(this._categories[c])
}},prevCategory:function(){if(this.options.categories.enabled){this._prevCategory();
this._trigger("prevCategory",null,{selectedCategory:this._getCurrentCategory()})
}},_prevCategory:function(){var c;
if(this._currentCategoryIndex==0){c=this._categories.length-1
}else{c=this._currentCategoryIndex-1
}this._gotoCategory(this._categories[c])
},gotoCategory:function(d){if(this.options.categories.enabled){var c=b.extend(true,{},this.options.categories);
c.selectedCategory=d;
this._setOption("categories",c);
this._trigger("gotoCategory",null,{selectedCategory:this._getCurrentCategory()})
}},_gotoCategory:function(g){var c=this._categoryData[g].images;
if(c&&c.length>0){var h=true,f,k=this._imagesCount(),e;
for(e=0;
e<k;
e++){this._removeImage(h,(e+1>this.options.categories.delAnimationCount?false:true))
}if((this.options.autoplay.enabled&&!this._isPauseManual)||this.options.categories.rememberLastCover){this._currentIndex=this._categoryData[g].selectedIndex
}var j=Math.max(0,this._currentIndex-this.options.categories.addAnimationRadius),d=Math.min(c.length-1,this._currentIndex+this.options.categories.addAnimationRadius);
for(e=0;
e<c.length;
e++){f=j<=e&&e<=d;
this._addImage(b(c[e]),h,f)
}this._setCurrentCategory(g);
this.options.categories.selectedCategory=g;
this._loadCategoryTitles()
}},nextCover:function(){this._nextCover();
this._trigger("nextCover",null,{selectedIndex:this._currentIndex})
},_nextCover:function(){var c;
if(this._currentIndex==this._imagesCount()-1){c=0
}else{c=this._currentIndex+1
}this._gotoCover(c)
},prevCover:function(){this._prevCover();
this._trigger("prevCover",null,{selectedIndex:this._currentIndex})
},_prevCover:function(){var c;
if(this._currentIndex==0){c=this._imagesCount()-1
}else{c=this._currentIndex-1
}this._gotoCover(c)
},gotoCover:function(c){this._setOption("selectedIndex",c);
this._trigger("gotoCover",null,{selectedIndex:this._currentIndex})
},_gotoCover:function(c,h){h=h||false;
if(this.options.slider.enabled&&!h){this._$slider.slider("value",c)
}var e,f,i=Math.max(0,c-this.options.cover.animation.radius),d=Math.min(this._$activeImages.length-1,c+this.options.cover.animation.radius);
for(e=0;
e<this._$activeImages.length;
e++){f=i<=e&&e<=d;
this._updateCover(f,h,c,e,this._$activeImages[e])
}this._currentIndex=c;
if(this.options.categories.enabled){var g=this._getCurrentCategory();
this._categoryData[g].selectedIndex=c
}if(this._currentIndex==this._imagesCount()){this._trigger("lastCover",null,{selectedIndex:this._currentIndex})
}},_createCover:function(e,g,c){c=c||a.center;
var f=false,d=this._coverConfig(this._currentIndex,e,c,f,{id:(new Date()).getTime()*Math.random(),click:this._clickCover.bind(this),mouseenter:this._autoplayMouseEnter.bind(this),mouseleave:this._autoplayMouseLeave.bind(this)});
b(g).show().cover(d).data("coverflow",{index:e,id:d.id})
},_loadImages:function(){for(var c=0;
c<this._$images.length;
c++){this._loadImage(this._$images[c],true)
}if(this.options.categories.enabled){if(!this.options.categories.selectedCategory){this.options.categories.selectedCategory=this._categories[0]
}this._categoryData[this.options.categories.selectedCategory].selectedIndex=this._currentIndex;
this._$activeImages=b(this._categoryData[this.options.categories.selectedCategory].images)
}else{this._$activeImages=this._$images
}this._$activeImages.each(this._createCover.bind(this))
},_loadImage:function(f,e){e=e||false;
var c=b(f).hide();
var d=null;
if(this.options.categories.enabled){d=c.data("category");
if(!d){d=this.options.categories.defaultCategory
}if(e){if(!this._categoryData[d]){this._categoryData[d]={selectedIndex:0,images:[]};
this._categories.push(d)
}this._categoryData[d].images.push(f)
}}return d
},_updateCover:function(c,i,e,h,d,f){f=f||a.center;
var j=this._coverConfig(e,h,f,i);
if(f==a.left){j.canvas.opacity=0;
j.animation.slide.easing="jswing"
}else{j.canvas.opacity=1
}var k=b(d).data("cover");
for(var g in j){k.option(g,j[g])
}k.refresh(c)
},_sliderChange:function(c,d){if(d.value!=this._currentIndex){this._gotoCover(d.value,true);
this._trigger("slide",null,{selectedIndex:this._currentIndex})
}},_clickCover:function(g,f){var c=f.image.data("coverflow").index;
var h=this._currentIndex;
this._gotoCover(c);
var d="backgroundCoverClick";
if(c==h){d="selectedCoverClick"
}this._trigger(d,null,{lastIndex:h,selectedIndex:this._currentIndex,image:f.image})
},_autoplayMouseEnter:function(){if(this.options.autoplay.pauseOnMouseenter){this._pause()
}this._trigger("mouseenter",null,{selectedIndex:this._currentIndex})
},_autoplayMouseLeave:function(){if(this.options.autoplay.pauseOnMouseenter){if(this.options.autoplay.enabled&&!this._isPauseManual){this._play()
}}this._trigger("mouseleave",null,{selectedIndex:this._currentIndex})
},_coverConfig:function(f,i,g,j,n){g=g||a.center;
n=n||{};
var k=0,d="center",e=0;
if(i<f){k=(f-i)*-1;
d="left"
}else{if(i>f){k=i-f;
d="right"
}}if(i!=f){e=1-(this.options.cover.background.size/100)
}var m=this.options.cover.animation.perspective.duration;
if(!j&&Math.abs(this._currentIndex-f)==1){m+=m*(this.options.cover.animation.perspective.inner/100)
}var c=this.options.cover.width-(e*this.options.cover.width),h=this.options.cover.height-(e*this.options.cover.height),l=b.extend(true,{},this.options.cover,n,{perspective:{position:d},width:c,height:h,canvas:{background:this.options.cover.background.style||this.element.css("background-color"),left:this._coverLeft(k,c,g),top:this._coverTop(k,h,e),zIndex:this._$activeImages.length-Math.abs(k)},animation:{slide:{duration:900,easing:"easeOutCirc"},perspective:{duration:m,easing:"jswing"}}});
return l
},_coverLeft:function(d,f,c){var g=0;
switch(c){case a.center:g=(this.options.width/2)-(f/2)+(f*d);
var e;
if(Math.abs(d)>1){e=(this.options.cover.background.overlap.outer/100)*f;
e*=Math.abs(d)-1;
e+=(this.options.cover.background.overlap.inner/100)*f
}else{e=(this.options.cover.background.overlap.inner/100)*f;
e*=Math.abs(d)
}if(d<0){g+=e
}else{if(d>0){g-=e
}}break;
case a.right:g=this.options.width-f;
break
}return g
},_coverTop:function(c,e,d){var f=0;
if(c!=0){f+=e*(d/2)
}return f
},_imagesCount:function(){return this._$activeImages.length
},_loadCategoryTitles:function(){if(!this.options.categories.renderTitles){return
}if(this._$categories){this._$categories.remove()
}this._$categories=b("<ul />").addClass("coverflow-categories");
for(var d in this._categories){var e=this._categories[d],c=b("<li />").text(e).click(b.curry(this,"gotoCategory",e));
if(e==this._getCurrentCategory()){c.addClass("coverflow-selected-category")
}this._$categories.append(c)
}this.element.before(this._$categories)
},_loadSlider:function(){if(!this.options.slider.enabled){return
}var d=this._imagesCount(),e=this.options.width-(1-(this.options.slider.width/100))*this.options.width,c=e/d;
this._$slider=b("<div />").bind("mouseenter",this._autoplayMouseEnter.bind(this)).bind("mouseleave",this._autoplayMouseLeave.bind(this)).css({width:e,position:"absolute",zIndex:d+1,left:(this.options.width-e)/2}).addClass("coverflow-slider").slider({animate:true,value:this._currentIndex,max:d-1,slide:this._sliderChange.bind(this)});
this._$sliderHandleHelper=this._$slider.find(".ui-slider-handle").css({width:c,marginLeft:-c/2-2}).wrap(b("<div class='ui-handle-helper-parent'></div>").width(e-c).css({position:"relative",height:"100%",margin:"auto"})).parent();
this.element.append(this._$slider)
},_syncSlider:function(){if(!this.options.slider.enabled){return
}var d=this._imagesCount();
this._$slider.css({zIndex:d+1}).slider("option","max",d-1).slider("value",this._currentIndex);
var e=this.options.width-(1-(this.options.slider.width/100))*this.options.width,c=e/d;
this._$sliderHandleHelper.width(e-c).find("a").css({width:c,marginLeft:-c/2-2})
}});
b.curry=function(f,e){var d=null,c=Array.prototype.slice.call(arguments,2);
if(arguments.length>=2){if(typeof e==="string"){d=f;
f=d[e];
e=undefined
}else{if(e&&!b.isFunction(e)){d=e;
e=undefined
}}}if(!e&&f){e=function(){var g=b.merge([],c);
g=b.merge(g,arguments);
return f.apply(d||this,g)
}
}if(f){e.guid=f.guid=f.guid||e.guid||b.guid++
}return e
}
})(jQuery);
